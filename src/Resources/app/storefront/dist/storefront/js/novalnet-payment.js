(window.webpackJsonp=window.webpackJsonp||[]).push([["novalnet-payment"],{qseZ:function(e,t,n){"use strict";n.r(t);var r=n("FGIj"),o=n("3xtq"),a=n("prSB"),l=n("k8s9"),u=n("477Q"),c=n("2Y4b"),i=n("gHbT");function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){return s(this,t),y(this,p(t).apply(this,arguments))}var n,r,m;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,e),n=t,(r=[{key:"init",value:function(){this._createScript((function(){var e=document.querySelectorAll('input[name="paymentMethodId"]'),t=document.querySelector("input[name=paymentMethodId]:checked"),n=document.querySelector("#novalnetId"),r=document.querySelector('#confirmOrderForm button[type="submit"]'),m=document.querySelector('#novalnetchangePaymentForm button[type="submit"]'),s=document.querySelectorAll('form[action$="/account/payment"]'),d=document.querySelector('form[action$="/account/payment"]'),y=this,p=new NovalnetPaymentForm,f="novalnetpayNameCookie",v=new l.a,g=a.a.getItem(f),h=!0,b=i.a.getDataAttribute(y.el,"data-lineitems",!1);if(null!=n){if(null==t||null==t){document.querySelector("#paymentMethod"+n.value).checked=!0,t=document.querySelector("input[name=paymentMethodId]:checked");var S=c.a.serialize(t.closest("form")),w=t.closest("form").getAttribute("action");v.post(w,S,(function(e){window.PluginManager.initializePlugins()}))}n.value===t.value&&(h=!1,null!=r&&(r.disabled=!0));var E={iframe:"#novalnetPaymentIframe",initForm:{orderInformation:{lineItems:b},showButton:!1,uncheckPayments:h}};0==a.a.getItem(f)||null==a.a.getItem(f)||h||n.value!==t.value||(E.initForm.checkPayment=g),1==s.length&&(E.initForm.styleText={forceStyling:{text:".payment-type-container > .payment-type > .payment-form{display: none !important;}"}}),p.initiate(E);var I=!1;p.validationResponse((function(e){I=!0,p.initiate(E),null!=r&&(r.disabled=!1)})),e.forEach((function(e){I&&!0===e.checked&&p.uncheckPayment()})),p.selectedPayment((function(e){if(a.a.setItem(f,e.payment_details.type),null!=document.getElementById("confirmOrderForm")&&("GOOGLEPAY"==e.payment_details.type||"APPLEPAY"==e.payment_details.type?document.getElementById("confirmOrderForm").style.display="none":document.getElementById("confirmOrderForm").style.display="block"),0==s.length&&null==m){if(n.value!==t.value){o.a.create(),document.querySelector("#paymentMethod"+n.value).checked=!0;var r=c.a.serialize(t.closest("form")),l=t.closest("form").getAttribute("action");v.post(l,r,(function(e){o.a.remove(),window.PluginManager.initializePlugins(),document.querySelector("#novalnetId").closest("form").submit()}))}}else document.querySelector("#paymentMethod"+n.value).checked=!0})),1!=s.length&&null==m||document.querySelectorAll('input[name="paymentMethodId"]').forEach((function(e){return e.addEventListener("click",(function(t){e.value!=n.value&&p.uncheckPayment()}))})),p.walletResponse({onProcessCompletion:function(e){return"SUCCESS"==e.result.status?(null!=m&&null!=m?(null!=document.getElementById("parentOrderNumber")&&(e.parentOrderNumber=document.getElementById("parentOrderNumber").value,e.aboId=document.getElementById("aboId").value,e.paymentMethodId=n.value),v.post(document.getElementById("storeCustomerDataUrl").value,JSON.stringify(e),(function(e){var t=JSON.parse(e);if(1==t.success&&null!=t.redirect_url)window.location.replace(t.redirect_url);else{if(1!=t.success)return y._displayErrorMsgSubs(t.message),{status:"FAILURE",statusText:"failure"};document.querySelector("#novalnetchangePaymentForm").submit()}}))):(document.querySelector("#novalnet-paymentdata").value=JSON.stringify(e),setTimeout((function(){document.querySelector("#confirmOrderForm").submit()}),500)),{status:"SUCCESS",statusText:"successfull"}):{status:"FAILURE",statusText:"failure"}}}),null!=r&&null!=r&&r.addEventListener("click",(function(e){if(n.value===t.value){var r=document.querySelector("#tos"),o=document.querySelector("#revocation");if(null!=r&&!r.checked&&null!=o&&!o.checked)return!1;if(null!=document.getElementById("confirmFormSubmit"))document.getElementById("confirmFormSubmit").disabled=!0,new u.a(document.getElementById("confirmFormSubmit")).create();else{var a=document.querySelector('#confirmOrderForm button[type="submit"]');a.disabled=!0,new u.a(a).create()}e.preventDefault(),e.stopImmediatePropagation(),p.getPayment((function(e){"100"==e.result.statusCode||"SUCCESS"==e.result.status?(document.querySelector("#novalnet-paymentdata").value=JSON.stringify(e),document.querySelector("#confirmOrderForm").submit()):(document.querySelector("#novalnet-paymentdata").value="",y._displayErrorMsg(e.result.message),y._showSubmitForm())}))}})),null!=m&&null!=m&&m.addEventListener("click",(function(e){document.querySelector('input[name="paymentMethodId"]:checked').value==n.value&&(e.preventDefault(),e.stopImmediatePropagation(),p.getPayment((function(e){if("100"==e.result.statusCode||"SUCCESS"==e.result.status){var t=new u.a(m);t.create(),null!=document.getElementById("parentOrderNumber")&&(e.parentOrderNumber=document.getElementById("parentOrderNumber").value,e.aboId=document.getElementById("aboId").value,e.paymentMethodId=n.value),v.post(document.getElementById("storeCustomerDataUrl").value,JSON.stringify(e),(function(e){var n=JSON.parse(e);1==n.success&&null!=n.redirect_url?window.location.replace(n.redirect_url):1==n.success?document.querySelector("#novalnetchangePaymentForm").submit():(y._displayErrorMsgSubs(n.message),t.remove())}))}else y._displayErrorMsgSubs(e.result.message)})))})),null!=d&&null!=d&&d.addEventListener("submit",(function(e){if(document.querySelector('input[name="paymentMethodId"]:checked').value==n.value){var r=c.a.serialize(t.closest("form")),a=t.closest("form").getAttribute("action");v.post(a,r,(function(e){o.a.remove(),window.PluginManager.initializePlugins()}))}}))}}))}},{key:"_createScript",value:function(e){var t="https://cdn.novalnet.de/js/pv13/checkout.js?"+(new Date).getTime(),n=document.createElement("script");n.type="text/javascript",n.src=t,n.addEventListener("load",e.bind(this),!1),document.head.appendChild(n)}},{key:"_displayErrorMsg",value:function(e){document.querySelector(".flashbags").innerHTML="";var t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("span");t.className="alert alert-danger alert-has-icon",n.className="alert-content-container",r.className="alert-content",o.className="icon icon-blocked",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="M12 24C5.3726 24 0 18.6274 0 12S5.3726 0 12 0s12 5.3726 12 12-5.3726 12-12 12zm0-2c5.5228 0 10-4.4772 10-10S17.5228 2 12 2 2 6.4772 2 12s4.4772 10 10 10zm4.2929-15.7071c.3905-.3905 1.0237-.3905 1.4142 0 .3905.3905.3905 1.0237 0 1.4142l-10 10c-.3905.3905-1.0237.3905-1.4142 0-.3905-.3905-.3905-1.0237 0-1.4142l10-10z" id="icons-default-blocked"></path></defs><use xlink:href="#icons-default-blocked" fill="#758CA3" fill-rule="evenodd"></use></svg>',t.appendChild(o),t.appendChild(n),n.appendChild(r),r.innerHTML=e,document.querySelector(".flashbags").appendChild(t),document.querySelector(".flashbags").scrollIntoView()}},{key:"_displayErrorMsgSubs",value:function(e){for(var t=document.getElementsByClassName("alert alert-danger alert-has-icon");t.length>0;)t[0].parentNode.removeChild(t[0]);var n=document.getElementById("novalnetchangePaymentForm"),r=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),l=document.createElement("span");r.className="alert alert-danger alert-has-icon",o.className="alert-content-container",a.className="alert-content",l.className="icon icon-blocked",l.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24" height="24" viewBox="0 0 24 24"><defs><path d="M12 24C5.3726 24 0 18.6274 0 12S5.3726 0 12 0s12 5.3726 12 12-5.3726 12-12 12zm0-2c5.5228 0 10-4.4772 10-10S17.5228 2 12 2 2 6.4772 2 12s4.4772 10 10 10zm4.2929-15.7071c.3905-.3905 1.0237-.3905 1.4142 0 .3905.3905.3905 1.0237 0 1.4142l-10 10c-.3905.3905-1.0237.3905-1.4142 0-.3905-.3905-.3905-1.0237 0-1.4142l10-10z" id="icons-default-blocked"></path></defs><use xlink:href="#icons-default-blocked" fill="#758CA3" fill-rule="evenodd"></use></svg>',r.appendChild(l),r.appendChild(o),o.appendChild(a),a.innerHTML=e,n.parentNode.insertBefore(r,n),r.scrollIntoView()}},{key:"_showSubmitForm",value:function(){if(null!=document.getElementById("confirmFormSubmit"))document.getElementById("confirmFormSubmit").disabled=!1,new u.a(document.getElementById("confirmFormSubmit")).remove();else{var e=document.querySelector('#confirmOrderForm button[type="submit"]');e.disabled=!1,new u.a(e).remove()}}}])&&d(n.prototype,r),m&&d(n,m),t}(r.a);window.PluginManager.register("NovalnetPayment",v,"#novalnet-payment-script")}},[["qseZ","runtime","vendor-node","vendor-shared"]]]);