"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["novalnet-payment"],{196:(e,t,n)=>{var a=n(6285),o=n(8254),l=n(1110);class r extends a.Z{init(){this.client=new o.Z;const e=document.querySelectorAll(".novalnet-payment-name"),t=document.querySelector("#nnShopVersion").value,n=["novalnetsepa","novalnetsepaguarantee","novalnetsepainstalment"],a=["novalnetinvoiceguarantee","novalnetinvoiceinstalment"];e.forEach((e=>{document.querySelector("input[name=paymentMethodId]:checked"),document.querySelector("#"+e.value+"Id");const o=document.querySelector('input[type="radio"].'+e.value+"-SavedPaymentMethods-tokenInput:checked"),r=document.querySelectorAll('input[type="radio"].'+e.value+"-SavedPaymentMethods-tokenInput");document.querySelectorAll('input[name="paymentMethodId"]');if(t>="6.4")var d=document.querySelector('#confirmOrderForm button[type="submit"]');else d=document.querySelector('#confirmPaymentForm button[type="submit"]');if(null!=o&&this.showComponents(o,e.value),"novalnetcreditcard"==e.value)this._createScript((()=>{const t=JSON.parse(document.getElementById(e.value+"-payment").getAttribute("data-"+e.value+"-payment-config"));this.loadIframe(t,e.value)}));else if(n.includes(e.value)||a.includes(e.value)){this._createScript((()=>{const t=JSON.parse(document.getElementById(e.value+"-payment").getAttribute("data-"+e.value+"-payment-config"));if("novalnetsepa"!=e.value&&null===t.company||!NovalnetUtility.isValidCompanyName(t.company)){document.getElementById(e.value+"DobField").style.display="block"}}));const t=document.getElementById(e.value+"AccountData"),n=document.getElementById(e.value+"AccountBic"),a=document.getElementById(e.value+"Mandate");null!=t&&(t.onpaste=e=>e.preventDefault(),["click","keydown","keyup"].forEach((e=>{t.addEventListener(e,(e=>{var t=e.target.value;null!=t&&null!=t&&((t=t.toUpperCase()).match(/(?:CH|MC|SM|GB|GI)/)?document.querySelector(".nn-bic-field").classList.remove("nnhide"):document.querySelector(".nn-bic-field").classList.add("nnhide"))}))}))),null!=a&&a.addEventListener("click",(()=>{null!=document.getElementById(e.value+"AboutMandate")&&1==document.getElementById(e.value+"AboutMandate").classList.contains("nnhide")?document.getElementById(e.value+"AboutMandate").classList.remove("nnhide"):document.getElementById(e.value+"AboutMandate").classList.add("nnhide")})),null!=n&&(n.onpaste=e=>e.preventDefault())}const u=document.querySelectorAll(".remove_cc_card_details"),c=document.querySelectorAll(".remove_card_details"),i=document.querySelectorAll(".remove_guarantee_card_details "),s=document.querySelectorAll(".remove_instalment_card_details");"novalnetcreditcard"===e.value?u.forEach((t=>{t.addEventListener("click",(()=>{this.removeStoredCard(t,e.value)}))})):"novalnetsepa"===e.value?c.forEach((t=>{t.addEventListener("click",(()=>{this.removeStoredCard(t,e.value)}))})):"novalnetsepaguarantee"===e.value?i.forEach((t=>{t.addEventListener("click",(()=>{this.removeStoredCard(t,e.value)}))})):"novalnetsepainstalment"===e.value&&s.forEach((t=>{t.addEventListener("click",(()=>{this.removeStoredCard(t,e.value)}))})),"novalnetinvoiceinstalment"!==e.value&&"novalnetsepainstalment"!==e.value||(null!=document.getElementById(e.value+"Duration")&&(document.getElementById(e.value+"Duration").selectedIndex=0,document.getElementById(e.value+"Duration").addEventListener("change",(t=>{const n=t.target.value;document.querySelectorAll("."+e.value+"Detail").forEach((function(e){e.dataset.duration===n?e.hidden=!1:e.hidden="hidden"}))}))),null!=document.getElementById(e.value+"Info")&&document.getElementById(e.value+"Info").addEventListener("click",(t=>{this.hideSummary(e.value)}))),null!=r&&r.forEach(((t,n)=>{t.addEventListener("click",(()=>{this.showComponents(t,e.value)}))})),null!=d&&d.addEventListener("click",(o=>{const r=document.querySelector("#"+e.value+"Id"),d=document.querySelector("input[name=paymentMethodId]:checked"),u=document.querySelector('input[type="radio"].'+e.value+"-SavedPaymentMethods-tokenInput:checked");if("novalnetcreditcard"==e.value){if(void 0!==r&&""!==r.value&&d.value===r.value&&(null==u||"new"==u.value)){var c=document.querySelector("#tos");if(null!=c&&!c.checked)return!1;if(null!=document.getElementById("confirmFormSubmit")){document.getElementById("confirmFormSubmit").disabled=!0;new l.Z(document.getElementById("confirmFormSubmit")).create()}else{var i=document.querySelector('#confirmOrderForm button[type="submit"]');i.disabled=!0;new l.Z(i).create()}o.preventDefault(),o.stopImmediatePropagation(),r.scrollIntoView(),NovalnetUtility.getPanHash()}}else if(n.includes(e.value)){const n=document.getElementById(e.value+"AccountData"),a=document.getElementById(e.value+"AccountBic"),o=document.getElementById(e.value+"Dob"),l=JSON.parse(document.getElementById(e.value+"-payment").getAttribute("data-"+e.value+"-payment-config"));if(void 0!==r&&""!==r.value&&d.value===r.value)if(void 0!==n&&""!==n.value||null!=u&&"new"!=u.value)if(void 0!==a&&""!==a.value||0!=document.querySelector(".nn-bic-field").classList.contains("nnhide")||null!=u&&"new"!=u.value){if("novalnetsepainstalment"===e.value&&(null===l.company||!NovalnetUtility.isValidCompanyName(l.company))||"novalnetsepaguarantee"===e.value&&(null===l.company||!NovalnetUtility.isValidCompanyName(l.company)||0===l.allowB2B))if(void 0===o||""===o.value){if(void 0!==document.getElementById("novalnetsepaId")&&null!=l.forceGuarantee&&1==l.forceGuarantee&&"novalnetsepaguarantee"===e.value)return t<"6.4"&&(d.value=document.getElementById("novalnetsepaId").value),document.getElementById("doForceSepaPayment").value=1,document.getElementById("SepaForcePayment").value=1,!0;this.preventForm(o,e.value,l.text.dobEmpty)}else if(void 0!==o&&""!==o.value){const n=this.validateAge(o.value);if((n<18||isNaN(n))&&void 0!==document.getElementById("novalnetsepaId")&&null!=l.forceGuarantee&&1==l.forceGuarantee&&"novalnetsepaguarantee"===e.value)return t<"6.4"&&(d.value=document.getElementById("novalnetsepaId").value),document.getElementById("doForceSepaPayment").value=1,document.getElementById("SepaForcePayment").value=1,!0;(n<18||isNaN(n))&&this.preventForm(o,e.value,l.text.dobInvalid)}}else this.preventForm(a,e.value,l.text.invalidIban);else this.preventForm(n,e.value,l.text.invalidIban)}else if(a.includes(e.value)){const n=document.getElementById(e.value+"Dob"),a=JSON.parse(document.getElementById(e.value+"-payment").getAttribute("data-"+e.value+"-payment-config"));if(void 0!==r.value&&""!==r.value&&d.value===r.value&&(null===a.company||!NovalnetUtility.isValidCompanyName(a.company)||0===a.allowB2B))if(void 0===n||""===n.value){if(void 0!==document.getElementById("novalnetinvoiceId")&&null!=a.forceGuarantee&&1==a.forceGuarantee&&"novalnetinvoiceguarantee"===e.value)return t<"6.4"&&(d.value=document.getElementById("novalnetinvoiceId").value),document.getElementById("doForceInvoicePayment").value=1,document.getElementById("InvoiceForcePayment").value=1,!0;this.preventForm(n,e.value,a.text.dobEmpty)}else if(void 0!==n&&""!==n.value){const o=this.validateAge(n.value);if((o<18||isNaN(o))&&void 0!==document.getElementById("novalnetinvoiceId")&&null!=a.forceGuarantee&&1==a.forceGuarantee&&"novalnetinvoiceguarantee"===e.value)return t<"6.4"&&(d.value=document.getElementById("novalnetinvoiceId").value),document.getElementById("doForceInvoicePayment").value=1,document.getElementById("InvoiceForcePayment").value=1,!0;(o<18||isNaN(o))&&this.preventForm(n,e.value,a.text.dobInvalid)}}}))}))}_createScript(e){const t=document.createElement("script");t.type="text/javascript",t.src="https://cdn.novalnet.de/js/v2/NovalnetUtility.js",t.addEventListener("load",e.bind(this),!1),document.head.appendChild(t)}loadIframe(e,t){if("novalnetcreditcard"===t){NovalnetUtility.setClientKey(e.clientKey);if(document.querySelector("#nnShopVersion").value>="6.4")var n=document.querySelector("#confirmOrderForm");else n=document.querySelector("#confirmPaymentForm");var a={callback:{on_success:function(e){return document.getElementById("novalnetcreditcard-panhash").value=e.hash,document.getElementById("novalnetcreditcard-uniqueid").value=e.unique_id,document.getElementById("novalnetcreditcard-doRedirect").value=e.do_redirect,null!=e.card_exp_month&&null!=e.card_exp_year&&(document.getElementById("novalnetcreditcard-expiry-date").value=e.card_exp_month+"/"+e.card_exp_year),document.getElementById("novalnetcreditcard-masked-card-no").value=e.card_number,document.getElementById("novalnetcreditcard-card-type").value=e.card_type,n.disabled=!1,n.submit(),!0},on_error:function(e){var t=document.getElementById("novalnetcreditcard-error-container"),a=t.querySelector(".alert-content");if(a.innerHTML="",void 0!==e.error_message&&""!==e.error_message){if(n.disabled=!1,null!=document.getElementById("confirmFormSubmit")){document.getElementById("confirmFormSubmit").disabled=!1;new l.Z(document.getElementById("confirmFormSubmit")).remove()}else{var o=document.querySelector('#confirmOrderForm button[type="submit"]');o.disabled=!1;new l.Z(o).remove()}a.innerHTML=e.error_message,t.style.display="block",t.scrollIntoView()}else t.style.display="none";return!1},on_show_overlay:function(e){document.getElementById("novalnetCreditcardIframe").classList.add("novalnet-challenge-window-overlay")},on_hide_overlay:function(e){document.getElementById("novalnetCreditcardIframe").classList.remove("novalnet-challenge-window-overlay")},on_show_captcha:function(){return elementContent.innerHTML="Your Credit Card details are Invalid",element.style.display="block",element.scrollIntoView(),elementContent.focus(),!1}},iframe:e.iframe,customer:e.customer,transaction:e.transaction,custom:e.custom};NovalnetUtility.createCreditCardForm(a)}}showComponents(e,t){"new"===e.value&&!0===e.checked?document.getElementById(t+"-payment-form").classList.remove("nnhide"):document.getElementById(t+"-payment-form").classList.add("nnhide")}hideSummary(e){const t=document.getElementById(e+"Summary");t.classList.contains("nnhide")?t.classList.remove("nnhide"):t.classList.add("nnhide")}removeStoredCard(e,t){var n=document.querySelector('input[name="'+t+'FormData[paymentToken]"]:checked');null!=n&&""!=n&&(this.client.post(document.getElementById("cardRemoveUrl").value,JSON.stringify({token:n.value}),""),setTimeout((()=>window.location.reload()),2e3))}_disableSubmitButton(){var e=document.querySelector("#confirmOrderForm button");e&&e.setAttribute("disabled","disabled")}validateAge(e){var t=new Date;if(void 0===e||""===e)return NaN;var n=e.split("."),a=t.getFullYear()-n[2],o=t.getMonth()-n[1];return((o+=1)<0||"0"==o&&t.getDate()<n[0])&&a--,a}preventForm(e,t,n){e.style.borderColor="red";var a=document.getElementById(t+"-error-container");event.preventDefault(),event.stopImmediatePropagation(),a.scrollIntoView();var o=a.querySelector(".alert-content");return o.innerHTML="",void 0!==n&&""!==n?(o.innerHTML=n,a.classList.remove("nnhide")):a.classList.add("nnhide"),!1}}var d=n(3206);class u extends a.Z{init(){new o.Z;this._createScript((()=>{try{d.Z.querySelectorAll(document,"[data-wallet-payments]");this._loadWalletPaymentForm()}catch(e){console.log(e.message)}}))}_createScript(e){const t=document.createElement("script");t.type="text/javascript",t.src="https://cdn.novalnet.de/js/v3/payment.js",t.addEventListener("load",e.bind(this),!1),document.head.appendChild(t)}_loadWalletPaymentForm(){var e=NovalnetPayment().createPaymentObject(),t=this.el,n=d.Z.getDataAttribute(this.el,"data-payment-config",!1),a=d.Z.querySelector(document,"#nnShopVersion"),l=new o.Z;if(null!=t&&("nn-apple-pay-button"==t.className||t.className.indexOf("nn-apple-pay-button")>=0))var r="novalnetapplepay";else r="novalnetgooglepay";var u={clientKey:n.clientKey,paymentIntent:{merchant:n.merchant,transaction:n.transaction,order:n.order,custom:n.custom,button:n.button,callbacks:{onProcessCompletion:function(e,n){if(e.result&&e.result.status)if("SUCCESS"==e.result.status){if("checkoutPage"==d.Z.getDataAttribute(t,"data-page-type")){if(null!=a&&a.value>="6.4")var o=d.Z.querySelector(document,"#confirmOrderForm");else o=d.Z.querySelector(document,"#confirmPaymentForm");if(null!=t&&"nn-apple-pay-button"==t.className)n({status:"SUCCESS",statusText:""}),document.getElementById("novalnetapplepay-wallet-token").value=e.transaction.token,o.submit();else if(document.getElementById("novalnetgooglepay-wallet-token").value=e.transaction.token,document.getElementById("novalnetgooglepay-do-redirect").value=e.transaction.doRedirect,e.transaction.doRedirect&&0!=e.transaction.doRedirect){const a=d.Z.getAttribute(t,"data-success-url"),o=d.Z.getAttribute(t,"data-paymentMethodId"),u=d.Z.getAttribute(t,"data-orderId"),c={serverResponse:e,paymentMethodId:o,paymentName:r,orderId:u};l.post(a,JSON.stringify(c),(e=>{const t=JSON.parse(e);1==t.success?(n({status:"SUCCESS",statusText:""}),window.location.replace(t.url)):window.location.reload()}))}else n({status:"SUCCESS",statusText:""}),o.submit();return!0}{const a=d.Z.getAttribute(t,"data-success-url"),o={serverResponse:e,paymentMethodId:d.Z.getAttribute(t,"data-paymentMethodId"),paymentName:r};l.post(a,JSON.stringify(o),(e=>{const t=JSON.parse(e);1==t.success?(n({status:"SUCCESS",statusText:""}),window.location.replace(t.url)):0==t.success?n({status:"FAILURE",statusText:t.message}):window.location.reload()}))}}else n({status:"FAILURE",statusText:e.result.status_text}),e.result.status_text&&alert(e.result.status_text)},onShippingContactChange:function(e,n){const a=d.Z.getDataAttribute(t,"data-shipping-url"),o={shippingInfo:e,paymentMethodId:d.Z.getAttribute(t,"data-paymentMethodId")};return new Promise(((e,t)=>{l.post(a,JSON.stringify(o),((n,a)=>{a.status>=400&&t(n);try{n=JSON.parse(n),e(n)}catch(e){t(e)}}))})).then((function(e){e.shipping.length?n({amount:e.totalPrice,lineItems:e.lineItem,methods:e.shipping,defaultIdentifier:e.shipping[0].identifier}):n({methodsNotFound:"No Shipping Contact Available, please enter a valid contact"})}))},onShippingMethodChange:function(e,n){const a=d.Z.getAttribute(t,"data-shippingUpdate-url"),o={shippingMethod:e};return new Promise(((e,t)=>{l.post(a,JSON.stringify(o),((a,o)=>{o.status>=400&&(t(a),n({status:"FAILURE"}));try{a=JSON.parse(a),e(a)}catch(e){t(e),n({status:"FAILURE"})}}))})).then((function(e){n({amount:e.totalPrice,lineItems:e.lineItem})}))},onPaymentButtonClicked:function(e){var n=document.querySelector("#tos");if(null!=n&&!n.checked&&"checkoutPage"==d.Z.getDataAttribute(t,"data-page-type")){if(null!=a&&a.value>="6.4")var o=d.Z.querySelector(document,"#confirmOrderForm");else o=d.Z.querySelector(document,"#confirmPaymentForm");return e({status:"FAILURE"}),o.submit(),!1}if("productDetailPage"==d.Z.getDataAttribute(t,"data-page-type")||"productListingPage"==d.Z.getDataAttribute(t,"data-page-type")){e({status:"SUCCESS"});var r=1;const n=d.Z.querySelector(t,"#productId").value,a=document.querySelector(".product-detail-quantity-select"),o=d.Z.getDataAttribute(t,"data-addToCartUrl",!1);null!=a&&(r=a.value),l.post(o,JSON.stringify({productId:n,quantity:r,type:"product"}),(e=>{const t=JSON.parse(e);0==t.success&&window.location.replace(t.url)}))}else e({status:"SUCCESS"})}}}};e.setPaymentIntent(u),e.isPaymentMethodAvailable((function(n){void 0!==t&&n&&("nn-apple-pay-button"==t.className&&void 0!==document.querySelectorAll(".nn-apple-pay-error-message")&&null!==document.querySelectorAll(".nn-apple-pay-error-message")&&document.querySelectorAll(".nn-apple-pay-error-message").forEach((function(e){e.remove()})),e.addPaymentButton("."+t.className),null!=t.querySelector("button")?t.querySelector("button").style.width="100%":null!=t.querySelector("apple-pay-button")&&(t.querySelector("apple-pay-button").style.width="100%"))}))}}const c=window.PluginManager;c.register("NovalnetPayment",r,"#novalnet-payment-script"),c.register("NovalnetWalletPayment",u,"[data-wallet-payments]")}},e=>{e.O(0,["vendor-node","vendor-shared"],(()=>{return t=196,e(e.s=t);var t}));e.O()}]);